{"version":3,"names":["Context","React","createContext","Host","children","style","managerRef","useRef","queue","useKey","generateKey","removeKey","useEffect","length","current","action","pop","type","mount","key","update","unmount","push","op","index","findIndex","o","flex"],"sources":["host.component.tsx"],"sourcesContent":["import * as React from 'react';\nimport { View, ViewStyle } from 'react-native';\n\nimport { useKey } from './hooks/useKey';\nimport { Manager, IManagerHandles } from './manager.component';\n\ninterface IHostProps {\n  children: React.ReactNode;\n  style?: ViewStyle;\n}\n\nexport interface IProvider {\n  mount(children: React.ReactNode): string;\n  update(key?: string, children?: React.ReactNode): void;\n  unmount(key?: string): void;\n}\n\nexport const Context = React.createContext<IProvider | null>(null);\n\nexport const Host = ({ children, style }: IHostProps): JSX.Element => {\n  const managerRef = React.useRef<IManagerHandles>(null);\n  const queue: {\n    type: 'mount' | 'update' | 'unmount';\n    key: string;\n    children?: React.ReactNode;\n  }[] = [];\n  const { generateKey, removeKey } = useKey();\n\n  React.useEffect(() => {\n    while (queue.length && managerRef.current) {\n      const action = queue.pop();\n\n      if (action) {\n        switch (action.type) {\n          case 'mount':\n            managerRef.current?.mount(action.key, action.children);\n            break;\n          case 'update':\n            managerRef.current?.update(action.key, action.children);\n            break;\n          case 'unmount':\n            managerRef.current?.unmount(action.key);\n            break;\n        }\n      }\n    }\n  }, []);\n\n  const mount = (children: React.ReactNode): string => {\n    const key = generateKey();\n\n    if (managerRef.current) {\n      managerRef.current.mount(key, children);\n    } else {\n      queue.push({ type: 'mount', key, children });\n    }\n\n    return key;\n  };\n\n  const update = (key: string, children: React.ReactNode): void => {\n    if (managerRef.current) {\n      managerRef.current.update(key, children);\n    } else {\n      const op = { type: 'mount' as 'mount', key, children };\n      const index = queue.findIndex(\n        (o) => o.type === 'mount' || (o.type === 'update' && o.key === key)\n      );\n\n      if (index > -1) {\n        queue[index] = op;\n      } else {\n        queue.push(op);\n      }\n    }\n  };\n\n  const unmount = (key: string): void => {\n    if (managerRef.current) {\n      managerRef.current.unmount(key);\n      removeKey(key);\n    } else {\n      queue.push({ type: 'unmount', key });\n    }\n  };\n\n  return (\n    <Context.Provider value={{ mount, update, unmount }}>\n      <View\n        style={[{ flex: 1 }, style]}\n        collapsable={false}\n        pointerEvents=\"box-none\"\n      >\n        {children}\n      </View>\n\n      <Manager ref={managerRef} />\n    </Context.Provider>\n  );\n};\n"],"mappings":"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"}